<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompts</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" />
  </head>
  <body>
    <div class="app-container">
      <aside class="sidebar">
        <h2>Menu</h2>
        <ul>
          <li><a href="#">Início</a></li>
          <li><a href="#">Sobre</a></li>
          <li><a href="#">Contato</a></li>
        </ul>
      </aside>
      <!-- overlay used on small screens when sidebar is open -->
      <div
        id="sidebar-overlay"
        class="sidebar-overlay"
        aria-hidden="true"
      ></div>

      <main>
        <header class="site-header">
          <button
            id="toggle-sidebar"
            class="btn-toggle"
            aria-label=""
            aria-expanded="true"
          >
            ☰
          </button>
          <h1 class="site-title" data-i18n="siteTitle">Prompts</h1>
          <div class="lang-select">
            <label for="lang-select-input" class="visually-hidden"
              >Language</label
            >
            <select id="lang-select-input" aria-label="Language selector">
              <option value="pt">PT-BR</option>
              <option value="en">EN</option>
            </select>
          </div>
        </header>

        <!-- #sym:main.main -->
        <div class="sym-main main">
          <section class="prompt-field">
            <div class="prompt-default">Campo</div>
            <h2 class="prompt-title">⚡ Planejamento de tarefas semanais</h2>
            <div class="prompt-default">default</div>
            <label for="prompt-text" class="visually-hidden"
              >Conteúdo do prompt</label
            >
            <textarea id="prompt-text" class="prompt-content" rows="8">
Me ajude a organizar minha semana de forma equilibrada.
Distribua minhas tarefas profissionais e pessoais em blocos de tempo realistas.

Sugira horários para foco profundo e momentos para pausas estratégicas.

Inclua dicas de priorização. No final, entregue o plano em formato de checklist diário para fácil acompanhamento.</textarea
            >

            <div class="prompt-actions">
              <button id="generate-plan" class="btn primary">
                Gerar plano
              </button>
              <button id="copy-checklist" class="btn">Copiar checklist</button>
              <button id="export-json" class="btn">Exportar JSON</button>
              <button id="clear-storage" class="btn">
                Limpar armazenamento
              </button>
              <button id="toggle-schedule" class="btn">Ajustar horários</button>
            </div>

            <div class="schedule-settings" id="schedule-settings" hidden>
              <p class="settings-note">
                Edite os horários dos blocos diários (formato livre, ex: 09:00 -
                11:00)
              </p>
              <div class="settings-grid">
                <label
                  >Slot 1
                  <input
                    class="schedule-input"
                    data-index="0"
                    value="09:00 - 11:00"
                /></label>
                <label
                  >Slot 2
                  <input
                    class="schedule-input"
                    data-index="1"
                    value="11:00 - 11:30"
                /></label>
                <label
                  >Slot 3
                  <input
                    class="schedule-input"
                    data-index="2"
                    value="11:30 - 13:00"
                /></label>
                <label
                  >Slot 4
                  <input
                    class="schedule-input"
                    data-index="3"
                    value="13:00 - 14:00"
                /></label>
                <label
                  >Slot 5
                  <input
                    class="schedule-input"
                    data-index="4"
                    value="14:00 - 16:00"
                /></label>
                <label
                  >Slot 6
                  <input
                    class="schedule-input"
                    data-index="5"
                    value="16:00 - 16:15"
                /></label>
                <label
                  >Slot 7
                  <input
                    class="schedule-input"
                    data-index="6"
                    value="16:15 - 17:30"
                /></label>
              </div>
            </div>

            <div class="prompt-filled">filled</div>
          </section>

          <section class="checklist-output" aria-live="polite">
            <!-- checklist gerado aparecerá aqui -->
          </section>
        </div>

        <div class="prompts">
          <div class="prompt">
            <h2>Prompt 1</h2>
            <p>Descreva o que você gostaria de fazer com o ChatGPT.</p>
          </div>

          <div class="prompt">
            <h2>Prompt 2</h2>
            <p>Explique o contexto ou o objetivo da sua interação.</p>
          </div>

          <div class="prompt">
            <h2>Prompt 3</h2>
            <p>
              Forneça detalhes específicos ou exemplos para melhor compreensão.
            </p>
          </div>
        </div>
      </main>
    </div>
    <script>
      // Toggle sidebar visibility on small screens with animated transitions
      ;(function () {
        const toggle = document.getElementById("toggle-sidebar")
        const app = document.querySelector(".app-container")
        const sidebar = document.querySelector(".sidebar")
        if (!toggle || !app || !sidebar) return

        function setState(open) {
          toggle.setAttribute("aria-expanded", String(open))
          toggle.setAttribute("aria-pressed", String(!open))
          const label = open
            ? i18n[currentLang] && i18n[currentLang].closeMenu
            : i18n[currentLang] && i18n[currentLang].openMenu
          toggle.setAttribute("aria-label", label || "")
          // show ✕ when menu is open (indicates close), show ☰ when closed
          toggle.textContent = open ? "✕" : "☰"
        }

        // initial state: sidebar visible
        setState(true)

        toggle.addEventListener("click", () => {
          const isHidden = app.classList.toggle("sidebar-hidden")
          const open = !isHidden
          setState(open)
        })

        // clicking the overlay closes the sidebar
        const overlay = document.getElementById("sidebar-overlay")
        if (overlay) {
          overlay.addEventListener("click", () => {
            app.classList.add("sidebar-hidden")
            setState(false)
          })
        }

        // initialize state: hide sidebar on small screens, show on larger
        const isSmall = window.matchMedia("(max-width: 800px)").matches
        if (isSmall) {
          app.classList.add("sidebar-hidden")
          setState(false)
        } else {
          app.classList.remove("sidebar-hidden")
          setState(true)
        }
      })()

      // Handlers for the interactive prompt (generate checklist + copy)
      ;(function () {
        // Simple i18n
        const i18n = {
          pt: {
            siteTitle: "Prompts",
            openMenu: "Abrir menu",
            closeMenu: "Cerrar menú",
            generatePlan: "Gerar plano",
            copyChecklist: "Copiar checklist",
            exportJson: "Exportar JSON",
            adjustSchedule: "Ajustar horários",
            clearStorage: "Limpar armazenamento",
            scheduleNote:
              "Edite os horários dos blocos diários (formato livre, ex: 09:00 - 11:00)",
          },
          en: {
            siteTitle: "Prompts",
            openMenu: "Open menu",
            closeMenu: "Close menu",
            generatePlan: "Generate plan",
            copyChecklist: "Copy checklist",
            exportJson: "Export JSON",
            adjustSchedule: "Adjust schedule",
            clearStorage: "Clear storage",
            scheduleNote:
              "Edit daily block times (free format, e.g. 09:00 - 11:00)",
          },
        }

        function applyTranslations(lang) {
          document.querySelectorAll("[data-i18n]").forEach((el) => {
            const key = el.getAttribute("data-i18n")
            if (i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key]
          })
          // translate button labels
          const btnMap = [
            ["generate-plan", "generatePlan"],
            ["copy-checklist", "copyChecklist"],
            ["export-json", "exportJson"],
            ["toggle-schedule", "adjustSchedule"],
            ["clear-storage", "clearStorage"],
          ]
          btnMap.forEach(([id, key]) => {
            const b = document.getElementById(id)
            if (b && i18n[lang][key]) b.textContent = i18n[lang][key]
          })
          const toggle = document.getElementById("toggle-sidebar")
          if (toggle)
            toggle.setAttribute("aria-label", i18n[lang].openMenu || "")
          const note = document.querySelector(".settings-note")
          if (note) note.textContent = i18n[lang].scheduleNote || ""
        }

        // Restore language
        const langInput = document.getElementById("lang-select-input")
        let currentLang = localStorage.getItem("lang") || "pt"
        if (langInput) {
          langInput.value = currentLang
          langInput.addEventListener("change", () => {
            currentLang = langInput.value
            localStorage.setItem("lang", currentLang)
            applyTranslations(currentLang)
          })
        }
        applyTranslations(currentLang)

        const generateBtn = document.getElementById("generate-plan")
        const copyBtn = document.getElementById("copy-checklist")
        const textarea = document.getElementById("prompt-text")
        const output = document.querySelector(".checklist-output")
        if (!generateBtn || !copyBtn || !textarea || !output) return

        function extractTasks(text) {
          // Heuristic: split by lines and sentences, prefer imperative fragments
          const lines = text
            .split(/\n+/)
            .map((l) => l.trim())
            .filter(Boolean)
          const tasks = []
          lines.forEach((l) => {
            l.split(/(?<=[\.\?\!])\s+/).forEach((s) => {
              const t = s.trim()
              // skip very short fragments
              if (t.length >= 15) tasks.push(t.replace(/^[\-\*\d\.\)\s]+/, ""))
            })
          })
          // fallback: chunk the text
          if (tasks.length === 0) {
            const chunks = text.match(/.{1,80}(?:\s|$)/g) || []
            chunks.forEach((c) => tasks.push(c.trim()))
          }
          return tasks.map((t) => t.replace(/\s+/g, " ").trim())
        }

        function generateWeeklyPlan(text) {
          const tasks = extractTasks(text)
          // Separate professional vs personal by simple keyword presence
          const pro = [],
            personal = []
          tasks.forEach((t) => {
            const lower = t.toLowerCase()
            if (/(profission|trabalho|cliente|reuni)/i.test(lower)) pro.push(t)
            else if (/(pessoal|casa|famili|dom|personal)/i.test(lower))
              personal.push(t)
            else {
              // balance by length: longer -> professional
              if (t.length > 60) pro.push(t)
              else personal.push(t)
            }
          })

          // create 7 days (Segunda a Domingo)
          const days = [
            "Segunda",
            "Terça",
            "Quarta",
            "Quinta",
            "Sexta",
            "Sábado",
            "Domingo",
          ].map((name) => ({ name, slots: [] }))

          // define daily slot templates
          const template = [
            { label: "09:00 - 11:00", type: "Foco profundo" },
            { label: "11:00 - 11:30", type: "Pausa" },
            { label: "11:30 - 13:00", type: "Tarefas/Execução" },
            { label: "13:00 - 14:00", type: "Almoço" },
            { label: "14:00 - 16:00", type: "Foco profundo" },
            { label: "16:00 - 16:15", type: "Pausa" },
            { label: "16:15 - 17:30", type: "Revisão/Comunicação" },
          ]

          // helper to pop from pro/personal lists
          function pickTask(prefer) {
            if (prefer === "pro" && pro.length) return pro.shift()
            if (prefer === "personal" && personal.length)
              return personal.shift()
            // otherwise take from pro then personal
            return pro.length
              ? pro.shift()
              : personal.length
              ? personal.shift()
              : null
          }

          // distribute tasks roughly evenly across weekdays first
          let cursor = 0
          const workDays = 5
          const allTasks = pro.concat(personal)
          allTasks.forEach((t, i) => {
            const dayIndex = i % workDays // put first across Mon-Fri
            const day = days[dayIndex]
            // try to place into a non-pause slot
            const slotIdx = i % (template.length - 2)
            day.slots.push({
              time: template[slotIdx].label,
              type: template[slotIdx].type,
              task: t,
            })
          })

          // ensure each day has base slots (fill empties with suggested breaks)
          days.forEach((day, idx) => {
            // build a normalized daySlots by template order
            const daySlots = template.map((s) => ({
              time: s.label,
              type: s.type,
              task: null,
            }))
            // fill from assigned slots sequentially
            let assignIndex = 0
            day.slots.forEach((asg) => {
              // find next non-pause slot to put task
              while (
                assignIndex < daySlots.length &&
                /Pausa|Almoço/.test(daySlots[assignIndex].type)
              )
                assignIndex++
              if (assignIndex >= daySlots.length) assignIndex = 0
              daySlots[assignIndex].task = asg.task
              assignIndex++
            })
            day.slots = daySlots
          })

          // generate prioritization tips
          const tips = [
            "Priorize tarefas de maior impacto no início do dia de foco profundo.",
            "Divida grandes tarefas em blocos menores e atribua a um único bloco de foco.",
            "Agrupe tarefas similares para reduzir custo de troca de contexto.",
            "Reserve o fim do dia para revisão e ajustes do plano do dia seguinte.",
          ]

          return { days, tips }
        }

        function renderPlan(plan) {
          const { days, tips } = plan
          output.innerHTML = ""
          const title = document.createElement("div")
          title.innerHTML = "<strong>Plano semanal sugerido</strong>"
          output.appendChild(title)

          days.forEach((day) => {
            const dayH = document.createElement("h3")
            dayH.textContent = day.name
            output.appendChild(dayH)
            const ul = document.createElement("ul")
            day.slots.forEach((slot) => {
              const li = document.createElement("li")
              if (slot.task)
                li.textContent = `${slot.time} — ${slot.type}: ${slot.task}`
              else li.textContent = `${slot.time} — ${slot.type}`
              ul.appendChild(li)
            })
            output.appendChild(ul)
          })

          const tipsH = document.createElement("h4")
          tipsH.textContent = "Dicas de priorização"
          output.appendChild(tipsH)
          const tUl = document.createElement("ul")
          tips.forEach((t) => {
            const li = document.createElement("li")
            li.textContent = t
            tUl.appendChild(li)
          })
          output.appendChild(tUl)
        }

        let lastPlan = null
        const toggleScheduleBtn = document.getElementById("toggle-schedule")
        const scheduleSettings = document.getElementById("schedule-settings")

        // Restore last plan and schedule template from localStorage if present
        try {
          const storedPlan = localStorage.getItem("lastPlan")
          if (storedPlan) {
            lastPlan = JSON.parse(storedPlan)
            // render restored plan
            renderPlan(lastPlan)
          }
        } catch (e) {
          // ignore parse errors
        }

        try {
          const storedTemplate = localStorage.getItem("scheduleTemplate")
          if (storedTemplate) {
            const values = JSON.parse(storedTemplate)
            const inputs = Array.from(
              document.querySelectorAll(".schedule-input")
            )
            inputs.forEach((inp, idx) => {
              if (values[idx]) inp.value = values[idx]
            })
          }
        } catch (e) {}

        function readCustomTemplate() {
          const inputs = Array.from(
            document.querySelectorAll(".schedule-input")
          )
          const vals = inputs.map((i) => i.value || i.getAttribute("value"))
          try {
            localStorage.setItem("scheduleTemplate", JSON.stringify(vals))
          } catch (e) {}
          return vals.map((v, idx) => ({
            label: v,
            type: [
              "Foco profundo",
              "Pausa",
              "Tarefas/Execução",
              "Almoço",
              "Foco profundo",
              "Pausa",
              "Revisão/Comunicação",
            ][idx],
          }))
        }

        toggleScheduleBtn.addEventListener("click", () => {
          if (!scheduleSettings) return
          scheduleSettings.hidden = !scheduleSettings.hidden
        })

        generateBtn.addEventListener("click", () => {
          const text = textarea.value || ""
          const customTemplate = readCustomTemplate()
          const plan = (function (text) {
            // generateWeeklyPlan but allow custom template
            const tasks = extractTasks(text)
            const pro = [],
              personal = []
            tasks.forEach((t) => {
              const lower = t.toLowerCase()
              if (/(profission|trabalho|cliente|reuni)/i.test(lower))
                pro.push(t)
              else if (/(pessoal|casa|famili|dom|personal)/i.test(lower))
                personal.push(t)
              else (t.length > 60 ? pro : personal).push(t)
            })
            const days = [
              "Segunda",
              "Terça",
              "Quarta",
              "Quinta",
              "Sexta",
              "Sábado",
              "Domingo",
            ].map((name) => ({ name, slots: [] }))
            const template = customTemplate
            const allTasks = pro.concat(personal)
            allTasks.forEach((t, i) => {
              const dayIndex = i % 5
              const slotIdx = i % (template.length - 2)
              const day = days[dayIndex]
              day.slots.push({
                time: template[slotIdx].label,
                type: template[slotIdx].type,
                task: t,
              })
            })
            days.forEach((day) => {
              const daySlots = template.map((s) => ({
                time: s.label,
                type: s.type,
                task: null,
              }))
              let assignIndex = 0
              day.slots.forEach((asg) => {
                while (
                  assignIndex < daySlots.length &&
                  /Pausa|Almoço/.test(daySlots[assignIndex].type)
                )
                  assignIndex++
                if (assignIndex >= daySlots.length) assignIndex = 0
                daySlots[assignIndex].task = asg.task
                assignIndex++
              })
              day.slots = daySlots
            })
            const tips = [
              "Priorize tarefas de maior impacto no início do dia de foco profundo.",
              "Divida grandes tarefas em blocos menores e atribua a um único bloco de foco.",
              "Agrupe tarefas similares para reduzir custo de troca de contexto.",
              "Reserve o fim do dia para revisão e ajustes do plano do dia seguinte.",
            ]
            return { days, tips }
          })(text)
          lastPlan = plan
          try {
            localStorage.setItem("lastPlan", JSON.stringify(lastPlan))
          } catch (e) {}
          if (!plan) {
            output.innerHTML = "<em>Não foi possível gerar o plano.</em>"
            return
          }
          renderPlan(plan)
        })

        copyBtn.addEventListener("click", async () => {
          // copy in Markdown if lastPlan available
          if (!lastPlan) {
            // fallback: copy visible text
            const text = output.innerText || ""
            try {
              await navigator.clipboard.writeText(text)
              copyBtn.textContent = "Copiado!"
              setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
            } catch (e) {
              copyBtn.textContent = "Erro ao copiar"
              setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
            }
            return
          }
          const md = []
          md.push("# Plano semanal sugerido")
          lastPlan.days.forEach((d) => {
            md.push(`\n## ${d.name}`)
            d.slots.forEach((s) => {
              if (s.task) md.push(`- **${s.time}** — ${s.type}: ${s.task}`)
              else md.push(`- **${s.time}** — ${s.type}`)
            })
          })
          md.push("\n### Dicas de priorização")
          lastPlan.tips.forEach((t) => md.push(`- ${t}`))
          const mdText = md.join("\n")
          try {
            await navigator.clipboard.writeText(mdText)
            copyBtn.textContent = "Copiado Markdown!"
            setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
          } catch (e) {
            copyBtn.textContent = "Erro ao copiar"
            setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
          }
        })

        // Export plan as JSON
        const exportBtn = document.getElementById("export-json")
        if (exportBtn) {
          exportBtn.addEventListener("click", () => {
            if (!lastPlan) return
            const blob = new Blob([JSON.stringify(lastPlan, null, 2)], {
              type: "application/json",
            })
            const url = URL.createObjectURL(blob)
            const a = document.createElement("a")
            a.href = url
            a.download = "plano-semanal.json"
            document.body.appendChild(a)
            a.click()
            a.remove()
            URL.revokeObjectURL(url)
          })
        }

        // Clear storage
        const clearBtn = document.getElementById("clear-storage")
        if (clearBtn) {
          clearBtn.addEventListener("click", () => {
            if (
              !confirm(
                "Deseja limpar o plano salvo e as configurações de horário?"
              )
            )
              return
            try {
              localStorage.removeItem("lastPlan")
              localStorage.removeItem("scheduleTemplate")
            } catch (e) {}
            lastPlan = null
            output.innerHTML = ""
            // reset schedule inputs to defaults
            const defaults = [
              "09:00 - 11:00",
              "11:00 - 11:30",
              "11:30 - 13:00",
              "13:00 - 14:00",
              "14:00 - 16:00",
              "16:00 - 16:15",
              "16:15 - 17:30",
            ]
            const inputs = Array.from(
              document.querySelectorAll(".schedule-input")
            )
            inputs.forEach((inp, idx) => {
              inp.value = defaults[idx]
            })
            alert("Armazenamento limpo.")
          })
        }

        copyBtn.addEventListener("click", async () => {
          const text = output.innerText || ""
          try {
            await navigator.clipboard.writeText(text)
            copyBtn.textContent = "Copiado!"
            setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
          } catch (e) {
            copyBtn.textContent = "Erro ao copiar"
            setTimeout(() => (copyBtn.textContent = "Copiar checklist"), 1800)
          }
        })
      })()
    </script>
  </body>
</html>
